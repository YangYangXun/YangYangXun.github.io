<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Laravel Session 機制</title>
      <link href="/2018/12/02/2018-12-2-Laravel-Session/"/>
      <url>/2018/12/02/2018-12-2-Laravel-Session/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>HTTP 是無狀態的，所以需要有一種能夠在請求之間紀錄狀態的法，透過這種紀錄的方法<br>網站系統才能夠判別使用者目前狀態 ( 登入 登出 權限等…)，因此 Session 就誕生拉。<br>Session 提供了一個在多個請求之間儲存有關用戶訊息的方法，本次主要介紹 Laravel 的 Session 機制。<br>之後會再使用原生 PHP 來比較一下。</p><h2 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h2><p>使用純 php 來實作 Session</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Session 的配置檔在 config / session.php 內。<br>初始配置以 File 的方式來記錄 Session。</p><ul><li>file- 將會話存儲在storage/framework/sessions中。</li></ul><p><img src="https://i.imgur.com/kcwgpEc.png" alt=""></p><p>除了使用 File 方式來儲存 Session， Laravel 還提供以下幾種方式 :</p><ul><li>cookie - Session 存儲在安全加密的cookie中。</li><li>database - 將會話存儲在數據庫中。</li><li>memcached / redis- Session 存儲在基於高速緩存的存儲系統中。</li><li>array - Sessions 存儲在 PHP 數組中，但不會被持久化。</li></ul><p>這篇先介紹以 database 方式來存 Session。之後有時間再來一一嘗試其他方法。</p><h2 id="以-Database-方式來存-Session"><a href="#以-Database-方式來存-Session" class="headerlink" title="以 Database 方式來存 Session"></a>以 Database 方式來存 Session</h2><h3 id="設定資料表"><a href="#設定資料表" class="headerlink" title="設定資料表"></a>設定資料表</h3><ul><li>我們利用 Migrate 的方式來建立 sessions 資料表，Schema 如下 :<br><code>`</code>php=</li></ul><p>Schema::create(‘sessions’, function ($table) {<br>    $table-&gt;string(‘id’)-&gt;unique();<br>    $table-&gt;unsignedInteger(‘user_id’)-&gt;nullable();<br>    $table-&gt;string(‘ip_address’, 45)-&gt;nullable();<br>    $table-&gt;text(‘user_agent’)-&gt;nullable();<br>    $table-&gt;text(‘payload’);<br>    $table-&gt;integer(‘last_activity’);<br>});</p><pre><code>* 使用 artisan 命令來 migrate</code></pre><p>php artisan session:table</p><p>php artisan migrate</p><pre><code>* 完成後如下![](https://i.imgur.com/4T4tHrR.png)接著下一章我們就來觀察 Session 如何記錄使用者狀態吧!## 使用 Session### Session 存入 sessions table 的時機* 當瀏覽器第一次訪問網站時 (分別用 IE 和 Chrome 請求)&gt;   可以看到下圖產生了兩個 Session![](https://i.imgur.com/v3nFm2d.png)* 透過 Laravel Auth 機制登入時ToDo### 獲取 Session * 如果你想要获取所有的 Session 数据，可以使用 all 方法：```php= $data = $request-&gt;session()-&gt;all();</code></pre><p>Result :<br><img src="https://i.imgur.com/TW7am1W.png" alt=""></p><ul><li>獲取 Sessio 中部份資料</li></ul><pre class=" language-php="><code class="language-php=">// 得到 Token$token = $request->session()->get('_token');// 得到上一次請求的 URL$request->session()->get('_previous')['url']</code></pre><ul><li>判断 Session 中是否存在某个值</li></ul><pre class=" language-php="><code class="language-php=">// 存在且不為 Null 可以用 has 判斷if ($request->session()->has('users')) {}// 存在且其值為 Null 可以用 exists 判斷if ($request->session()->exists('users')) {}</code></pre><h3 id="存儲數據"><a href="#存儲數據" class="headerlink" title="存儲數據"></a>存儲數據</h3><ul><li>存入鍵值對到 Session 中有 2 種方法</li></ul><ol><li>通過請求實例</li><li>通過全局函數</li></ol><pre class=" language-php="><code class="language-php=">// 通過請求實例$request->session()->put('key', 'value');// 通過全局函數session(['key' => 'value']);</code></pre>]]></content>
      
      
      <categories>
          
          <category> Backed-End </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Laravel </tag>
            
            <tag> Session </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Laravel 表單驗證</title>
      <link href="/2018/12/01/2018-12-1-laravel-formvarify/"/>
      <url>/2018/12/01/2018-12-1-laravel-formvarify/</url>
      
        <content type="html"><![CDATA[<h1 id="Laravel-表單驗證"><a href="#Laravel-表單驗證" class="headerlink" title="Laravel 表單驗證"></a>Laravel 表單驗證</h1><ul><li>在laravel中，其實可以說是有兩種方式來進行表單驗證：使用 Request 和使用 Validation 。</li><li>5.5 新增 make rule 方式</li></ul><h2 id="Request-表單驗證"><a href="#Request-表單驗證" class="headerlink" title="Request 表單驗證"></a>Request 表單驗證</h2><ul><li>使用artisan這個工具</li></ul><p><code>php artisan make:request TestRequest</code></p><ul><li>File</li></ul><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">TestRequest</span> <span class="token keyword">extends</span> <span class="token class-name">FormRequest</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * Determine if the user is authorized to make this request.     *      * @return bool     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">/**          authorize()可以這樣簡單地理解：我們在處理這個表單請求(通常是一個post請求)的時候是否是需要進行身份驗證，這種驗證是指：          比如A發表的評論，B能不能進行編輯。如果不能，則保留返回false，如果可以，則修改返回true。          那麼我們這裡的邏輯是：既然是發表文章，在我們這個站點註冊的用戶(如果開放註冊的話)都是可以發表文章的，          所以我們首先修改authorize()方法，將其返回值改為：return true;。        */</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Get the validation rules that apply to the request.     *     * @return array     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>            <span class="token comment" spellcheck="true">//</span>        <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Validation-表單驗證"><a href="#Validation-表單驗證" class="headerlink" title="Validation 表單驗證"></a>Validation 表單驗證</h2><ul><li>使用 ValidatesRequestsTrait 的 validate 方法</li></ul><pre class=" language-php"><code class="language-php"> v5<span class="token number">.6</span> <span class="token variable">$validatedData</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required|unique:posts|max:255'</span><span class="token punctuation">,</span>    <span class="token string">'body'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> v5<span class="token number">.4</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>    <span class="token string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required|unique:posts|max:255'</span><span class="token punctuation">,</span>    <span class="token string">'body'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required'</span><span class="token punctuation">,</span>    <span class="token string">'publish_at'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'nullable|date'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>如果你不想要使用請求上使用 validate 方法，你可以通過 validator Validator facade 手動創建一個驗證器實例。用 Facade 上的 make 方法生成一個新的驗證器實例：</li></ul><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Validator</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * 保存一篇新的博客文章。     *     * @param  Request  $request     * @return Response     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 傳給 make 方法的第一個參數是要驗證的數據。第二個參數則是該數據的驗證規則。</span>        <span class="token variable">$validator</span> <span class="token operator">=</span> Validator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>            <span class="token string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required|unique:posts|max:255'</span><span class="token punctuation">,</span>            <span class="token string">'body'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required'</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'post/create'</span><span class="token punctuation">)</span>                        <span class="token operator">-</span><span class="token operator">></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token punctuation">)</span>                        <span class="token operator">-</span><span class="token operator">></span><span class="token function">withInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 保存文章...</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="可用驗證規則"><a href="#可用驗證規則" class="headerlink" title="可用驗證規則"></a>可用驗證規則</h2><ul><li><code>Unique</code> : 驗證的字段在給定的數據庫表中必須是唯一的。如果沒有指定 column ，將會使用字段本身的名稱。<pre><code>&#39;email&#39; =&gt; &#39;unique:users,email_address&#39;</code></pre></li></ul><h2 id="顯示驗證錯誤信息"><a href="#顯示驗證錯誤信息" class="headerlink" title="顯示驗證錯誤信息"></a>顯示驗證錯誤信息</h2><p>如果傳入的請求參數未通過給定的驗證規則呢？正如前面所提到的，Laravel會自動把用戶重定向到之前的位置。另外，<strong>所有的驗證錯誤信息會被自動閃存到session</strong> .</p><p>重申一次，我們不必在GET路由中將錯誤消息顯式綁定到視圖。<strong>因為Lavarel會檢查在Session數據中的錯誤信息，並自動將其綁定到視圖</strong>（如果這個視圖文件存在）。而其中的變量 $errors 是Illuminate\Support\MessageBag 的一個實例。</p><h2 id="處理錯誤消息"><a href="#處理錯誤消息" class="headerlink" title="處理錯誤消息"></a>處理錯誤消息</h2><h2 id="Google-ReCAPTCHA-我不是機器人"><a href="#Google-ReCAPTCHA-我不是機器人" class="headerlink" title="Google ReCAPTCHA 我不是機器人"></a>Google ReCAPTCHA 我不是機器人</h2><ul><li>reCAPTCHA 本來專做 CAPTCHA 的公司, 在 2009 年被 Google 收購<br>主要的目的大部是為了防止機器人濫用服務、大量留言等問題<br>我們會為了防止這些問題, 請使用者輸入一些被混淆過的文字、圖形字進判斷使用者是不是真人…. , 其中最明顯的受害者就是線上訂票系統.</li><li>Google最早之前是使用reCAPTCHA v1，必須要輸入圖形驗證碼後才能夠通過驗證，而就在今年(2018/03/31)，Google正式取消reCAPTCHA v1的使用</li><li>reCAPTCHA v2</li></ul><h2 id="請先向Google大神申請一組reCAPTCHA驗證碼"><a href="#請先向Google大神申請一組reCAPTCHA驗證碼" class="headerlink" title="請先向Google大神申請一組reCAPTCHA驗證碼"></a>請先向Google大神申請一組reCAPTCHA驗證碼</h2><p>填寫Google reCAPTCHA申請表單 - <a href="https://www.google.com/recaptcha/admin" target="_blank" rel="noopener">https://www.google.com/recaptcha/admin</a><br>Label： 填入標籤文字以便日後辨識哪一組reCAPTCHA是屬於那一類用途</p><p>Domains：可填入多組網域名，每換一行為一組，以dev.neticrm.tw為例</p><p>點擊Register</p><p>申請成功！至Adding reCAPTCHA to your site區塊中，取得兩個金鑰：Site key及Secret Key(如下圖中被黃色矩形覆蓋的內容)</p><ul><li>ref</li></ul><p><a href="https://cola.workxplay.net/what-is-google-recaptcha/" target="_blank" rel="noopener">https://cola.workxplay.net/what-is-google-recaptcha/</a></p><ul><li>Packagelist </li><li>google/recaptcha</li><li>anhskohbo/no-captcha <a href="https://packagist.org/packages/anhskohbo/no-captcha" target="_blank" rel="noopener">https://packagist.org/packages/anhskohbo/no-captcha</a><br><code>`</code><br>composer require google/recaptcha “~1.1”<br>差異?<br>composer require google/recaptcha “^1.2”</li></ul><p>“require”: {<br>    “google/recaptcha”: “^1.2”<br>}</p><pre><code>* laravel make:rule * 研究 laravel app\Rules</code></pre><p>php artisan make:rule Captcha<br><code>`</code></p>]]></content>
      
      
      <categories>
          
          <category> Backed-End </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Laravel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hello World</title>
      <link href="/2018/12/01/hello-world/"/>
      <url>/2018/12/01/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> design </category>
          
      </categories>
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
